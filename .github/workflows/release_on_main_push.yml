name: Build and Release
on: 
    push:
      branches:
        - main
      
jobs:
    Build:
      if: ${{ !contains(github.event.head_commit.message, '[skip build]') }}
      name: Build and Release
      runs-on: ubuntu-latest
      steps:
        - name: "Checkout repository"
          uses: actions/checkout@v4

        # Change version in the .python-version file.
        - name: Setup Python
          uses: actions/setup-python@v4

        - name: Setup Environment
          run: |
            python -m pip install --upgrade pip
            pip install -r requirements.txt

        - name: Build
          run: python package.py build

        - name: "Create Github Release"
          run: |
            gh release create "$PACKAGE_BUILD_VERSION" \
              ./dist/*.tar.gz \
              ./dist/*.whl \
              --repo="$GITHUB_REPOSITORY" \
              --title="$PACKAGE_BUILD_VERSION" \
              --generate-notes
        
       